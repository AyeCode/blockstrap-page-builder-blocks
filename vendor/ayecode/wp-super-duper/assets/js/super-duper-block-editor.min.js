window.sdBlockFunctions=window.sdBlockFunctions||{};window.sdBlockEditComponents=window.sdBlockEditComponents||{};window.sdBlockSaveComponents=window.sdBlockSaveComponents||{};window.sdBlockInputComponents=window.sdBlockInputComponents||{};(function(wp){if(!wp||!wp.blocks||!wp.element||!wp.blockEditor||!wp.components){console.error("Super Duper: A required WordPress script package is not available.");return}const{blocks,element,blockEditor,components,i18n}=wp;const lastFocusedInput={element:null,name:null};const{createElement:el,useState,useEffect,Fragment,useRef,useMemo}=element;const{__}=i18n;const{registerBlockType,createBlock}=blocks;const{InspectorControls,BlockControls,RichText,useBlockProps,MediaUpload,MediaUploadCheck,InnerBlocks}=blockEditor;const{PanelBody,TabPanel,TextControl,InputControl,TextareaControl,SelectControl,RangeControl,CheckboxControl,ToggleControl,Button,ColorPicker,Notice,BaseControl,ResponsiveWrapper,ToolbarGroup,ToolbarButton,FocalPointPicker,GradientPicker}=components;const DeviceSwitcherIcon=({isInlineRow})=>{const[isPopoverVisible,setPopoverVisible]=useState(false);const deviceType=wp.data.useSelect(select=>select("core/editor")?.getDeviceType()||"Desktop",[]);const dashiconMap={Desktop:"desktop",Tablet:"tablet",Mobile:"smartphone"};const icon=dashiconMap[deviceType]||"desktop";const setDeviceType=type=>{wp.data.dispatch("core/editor").setDeviceType(type);setPopoverVisible(false)};const popoverStyle={position:"absolute",right:isInlineRow?"-8px":"-6px",bottom:isInlineRow?"20px":"20px",backgroundColor:"white",border:"1px solid #ccc",borderRadius:"3px",padding:"4px",zIndex:99999,display:"flex",flexDirection:"column",gap:"4px",boxShadow:"0 3px 6px rgba(0,0,0,0.1)"};return el("span",{className:"sd-device-switcher-wrapper"},el("span",{className:"sd-device-switcher",style:{position:"relative"}},el("span",{className:`dashicons dashicons-${icon}`,style:{cursor:"pointer",color:"var(--wp-admin-theme-color)"},onClick:e=>{e.stopPropagation();setPopoverVisible(!isPopoverVisible)}}),isPopoverVisible&&el("div",{style:popoverStyle},el(Button,{isSmall:true,icon:"desktop",style:{color:"var(--wp-admin-theme-color)"},onClick:()=>setDeviceType("Desktop")}),el(Button,{isSmall:true,icon:"tablet",style:{color:"var(--wp-admin-theme-color)"},onClick:()=>setDeviceType("Tablet")}),el(Button,{isSmall:true,icon:"smartphone",style:{color:"var(--wp-admin-theme-color)"},onClick:()=>setDeviceType("Mobile")}))))};function parseLegacyRequireString(str){if(!str||typeof str!=="string")return null;const cleanedStr=str.trim().replace(/^[(]|[)]$/g,"").replace(/\[%|%]/g,"");const parts=cleanedStr.split(/(&&|\|\|)/g).map(p=>p.trim()).filter(Boolean);if(parts.length===0)return null;const conditions=[];let operator="AND";const castValue=val=>{if(val==="true")return true;if(val==="false")return false;if(!isNaN(parseFloat(val))&&isFinite(val))return parseFloat(val);return val.replace(/^['"]|['"]$/g,"")};for(const part of parts){if(part==="&&"){operator="AND";continue}if(part==="||"){operator="OR";continue}const match=part.match(/^(\w+)\s*([!=<>]+)?\s*(.*)?$/);if(!match)continue;const condition={attribute:match[1]};const compare=match[2]||null;const valueStr=match[3]||null;if(compare){condition.compare=compare.replace("==","===").replace("!=","!==");condition.value=castValue(valueStr)}else{condition.compare="exists"}conditions.push(condition)}return{operator:operator,conditions:conditions}}function executeLogicObject(logic,attributes){if(!logic||typeof logic!=="object"||!logic.conditions||!logic.conditions.length)return true;const checkCondition=condition=>{const{attribute,compare,value}=condition;const actualValue=attributes[attribute];if((compare==="==="||compare==="==")&&(value===""||value===false)){return actualValue===false||actualValue===""||actualValue==null}if((compare==="!=="||compare==="!=")&&(value===""||value===false)){return actualValue!==false&&actualValue!==""&&actualValue!=null}switch(compare){case"===":return actualValue===value;case"!==":return actualValue!==value;case">":return actualValue>value;case"<":return actualValue<value;case">=":return actualValue>=value;case"<=":return actualValue<=value;case"exists":return!!actualValue;default:return false}};const results=logic.conditions.map(condition=>condition.operator?executeLogicObject(condition,attributes):checkCondition(condition));if(logic.operator==="OR")return results.some(res=>res===true);return results.every(res=>res===true)}function evaluateRequirement(requirement,attributes){if(typeof requirement==="object"&&requirement!==null){return executeLogicObject(requirement,attributes)}if(typeof requirement==="string"){const logicObject=parseLegacyRequireString(requirement);return executeLogicObject(logicObject,attributes)}return true}function renderInlineControl(config,props){const{attributes,setAttributes}=props;const{type,name,options,default:defaultValue,icon,title}=config;const value=attributes[name]!==undefined?attributes[name]:defaultValue;switch(type){case"select":let selectOptions=[];if(options&&typeof options==="object"){selectOptions=Object.keys(options).map(key=>({label:options[key],value:key}))}const svgIcons={"box-top":`<svg title="${title}" width="20px" height="20px" viewBox="0 0 20 20"><rect x="5.518" y="2.186" width="8.964" height="2.482" fill="#272B2F"></rect><rect x="2.714" y="5.492" width="1.048" height="9.017" fill="#555D66"></rect><rect x="16.265" y="5.498" width="1.023" height="9.003" fill="#555D66"></rect><rect x="5.487" y="16.261" width="9.026" height="1.037" fill="#555D66"></rect></svg>`,"box-right":`<svg title="${title}" width="20px" height="20px" viewBox="0 0 20 20"><rect x="15.244" y="5.498" width="2.518" height="9.003" fill="#272B2F"></rect><rect x="2.714" y="5.492" width="1.046" height="9.017" fill="#555D66"></rect><rect x="5.518" y="2.719" width="8.964" height="0.954" fill="#555D66"></rect><rect x="5.487" y="16.308" width="9.026" height="0.99" fill="#555D66"></rect></svg>`,"box-bottom":`<svg title="${title}" width="20px" height="20px" viewBox="0 0 20 20"><rect x="5.487" y="15.28" width="9.026" height="2.499" fill="#272B2F"></rect><rect x="2.714" y="5.492" width="1" height="9.017" fill="#555D66"></rect><rect x="16.261" y="5.498" width="1.027" height="9.003" fill="#555D66"></rect><rect x="5.518" y="2.719" width="8.964" height="0.968" fill="#555D66"></rect></svg>`,"box-left":`<svg title="${title}" width="20px" height="20px" viewBox="0 0 20 20"><rect x="2.202" y="5.492" width="2.503" height="9.017" fill="#272B2F"></rect><rect x="16.276" y="5.498" width="1.012" height="9.003" fill="#555D66"></rect><rect x="5.518" y="2.719" width="8.964" height="0.966" fill="#555D66"></rect><rect x="5.487" y="16.303" width="9.026" height="0.995" fill="#555D66"></rect></svg>`};const customIcon=icon&&svgIcons[icon]?el("span",{dangerouslySetInnerHTML:{__html:svgIcons[icon]}}):null;return el("div",{key:name,className:"sd-inline-control",style:{textAlign:"center",display:"flex",flexDirection:"column",flex:1}},customIcon,el(SelectControl,{value:String(value||""),options:selectOptions,onChange:val=>setAttributes({[name]:val})}));default:return el(TextControl,{key:name,value:value||"",type:type,onChange:val=>setAttributes({[name]:val})})}}function renderControl(config,props,deviceType){if(config.device_type&&config.device_type!==deviceType){return null}const{attributes,setAttributes,openVisibilityModal}=props;const{type,name,label,title,help,desc,options,default:defaultValue,...rest}=config;const value=attributes[name]!==undefined?attributes[name]:defaultValue;const controlLabel=label||title;const controlHelp=help||desc;const labelWithIcon=config.device_type?el("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},el("span",{},controlLabel),el(DeviceSwitcherIcon,{isInlineRow:false})):controlLabel;if(config.element_require&&!evaluateRequirement(config.element_require,attributes)){return null}if(config.advanced&&!attributes.show_advanced)return null;switch(type){case"hidden":return null;case"textarea":{let dynamicDataButton=null;if(config.dynamic_data&&window.sdBlockTools?.DynamicDataButton){const buttonStyle={position:"absolute",top:"0",right:"0",zIndex:2,zoom:"0.7",background:"#fff"};dynamicDataButton=el(window.sdBlockTools.DynamicDataButton,{style:buttonStyle,onSelect:dataTag=>{if(!lastFocusedInput.element||lastFocusedInput.name!==name){const currentValue=attributes[name]||"";const newValue=(currentValue?currentValue+" ":"")+dataTag;setAttributes({[name]:newValue});return}const input=lastFocusedInput.element;const start=input.selectionStart;const end=input.selectionEnd;const currentValue=input.value;const newValue=currentValue.substring(0,start)+dataTag+currentValue.substring(end);setAttributes({[name]:newValue})}})}const textareaEventHandlers={onFocus:event=>{lastFocusedInput.element=event.target;lastFocusedInput.name=name},onClick:event=>{lastFocusedInput.element=event.target;lastFocusedInput.name=name},onKeyUp:event=>{lastFocusedInput.element=event.target;lastFocusedInput.name=name}};return el(BaseControl,{label:labelWithIcon,id:name,key:name},el("div",{style:{position:"relative"}},el(TextareaControl,{id:name,value:value||"",onChange:val=>setAttributes({[name]:val}),...rest,...textareaEventHandlers}),dynamicDataButton),controlHelp&&el("p",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:controlHelp}}))}case"text":case"number":case"email":case"url":case"password":{const actionButtons=[];if(config.icon_picker&&window.sdBlockTools?.IconPickerButton){actionButtons.push(el(window.sdBlockTools.IconPickerButton,{key:"icon-picker",variant:"tertiary",isSmall:true,value:value,attributeName:name,setAttributes:setAttributes}))}if(config.dynamic_data&&window.sdBlockTools?.DynamicDataButton){actionButtons.push(el(window.sdBlockTools.DynamicDataButton,{key:"dynamic-data",variant:"tertiary",isSmall:true,onSelect:dataTag=>{if(!lastFocusedInput.element||lastFocusedInput.name!==name){const currentValue=attributes[name]||"";const newValue=(currentValue?currentValue+" ":"")+dataTag;setAttributes({[name]:newValue});return}const input=lastFocusedInput.element;const start=input.selectionStart;const end=input.selectionEnd;const currentValue=input.value;const newValue=currentValue.substring(0,start)+dataTag+currentValue.substring(end);setAttributes({[name]:newValue})}}))}const inputEventHandlers={onFocus:event=>{lastFocusedInput.element=event.target;lastFocusedInput.name=name},onClick:event=>{lastFocusedInput.element=event.target;lastFocusedInput.name=name},onKeyUp:event=>{lastFocusedInput.element=event.target;lastFocusedInput.name=name}};if(InputControl){const suffixContent=actionButtons.length>0?el(Fragment,{},actionButtons):null;return el(BaseControl,{label:labelWithIcon,id:name,key:name},el(InputControl,{id:name,value:value||"",onChange:val=>setAttributes({[name]:val}),type:type,suffix:suffixContent,...rest,...inputEventHandlers}),controlHelp&&el("p",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:controlHelp}}))}else{const textInputElement=el(TextControl,{id:name,value:value||"",onChange:val=>setAttributes({[name]:val}),type:type,...rest,...inputEventHandlers});if(actionButtons.length>0){const styledButtons=actionButtons.map(button=>el(button.type,{...button.props,style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,marginLeft:"-1px",zIndex:1}}));const controlElement=el("div",{style:{display:"flex",alignItems:"stretch"}},el("div",{style:{flex:1}},textInputElement),styledButtons);return el(BaseControl,{label:labelWithIcon,id:name,key:name},controlElement,controlHelp&&el("p",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:controlHelp}}))}return el(BaseControl,{label:labelWithIcon,id:name,key:name},textInputElement,controlHelp&&el("p",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:controlHelp}}))}}case"range":return el(BaseControl,{key:name,label:labelWithIcon,id:name},el(RangeControl,{value:value!==undefined?Number(value):undefined,onChange:val=>setAttributes({[name]:String(val)}),min:rest.custom_attributes?.min,max:rest.custom_attributes?.max,...rest}),controlHelp&&el("p",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:controlHelp}}));case"image":const idName=rest.id_attribute||`${name}_id`;const imageId=attributes[idName];const onSelectImage=media=>{const attributesToUpdate={[name]:media.url,[idName]:media.id};const nameParts=name.split("_");const baseName=nameParts[0];const altAttributeName=`${baseName}_alt`;if(attributes.hasOwnProperty(altAttributeName)&&!attributes[altAttributeName]&&media.alt){attributesToUpdate[altAttributeName]=media.alt}setAttributes(attributesToUpdate)};const onRemoveImage=()=>setAttributes({[name]:"",[idName]:""});return el(BaseControl,{key:name,label:labelWithIcon},el(MediaUploadCheck,{},el(MediaUpload,{onSelect:onSelectImage,allowedTypes:["image"],value:imageId,render:({open})=>{const currentImageUrl=attributes[name];if(rest.focalpoint){const focalPointAttrName=rest.focal_point_attribute||`${name}_xy`;const focalPointValue=attributes[focalPointAttrName]||{x:.5,y:.5};const onFocalPointChange=newFocalPoint=>setAttributes({[focalPointAttrName]:newFocalPoint});return el("div",{},!currentImageUrl&&el(Button,{isPrimary:true,onClick:open},"Upload Image"),currentImageUrl&&el(FocalPointPicker,{url:currentImageUrl,value:focalPointValue,onChange:onFocalPointChange}),currentImageUrl&&el(Button,{isSecondary:true,onClick:onRemoveImage,style:{marginTop:"8px"}},"Clear"))}return el("div",{},!currentImageUrl&&el(Button,{isPrimary:true,onClick:open},"Upload Image"),currentImageUrl&&el("img",{src:currentImageUrl,style:{maxWidth:"100%",background:"#ccc",display:"block",margin:"8px 0"}}),currentImageUrl&&el(Button,{isSecondary:true,onClick:onRemoveImage},"Clear"))}})));case"images":{const ImagesPreviewControl=({value,name,setAttributes})=>{const{useState,useEffect,useRef}=wp.element;const{__}=wp.i18n;const localImagesRef=useRef([]);const dragItem=useRef(null);const[localImages,setLocalImages]=useState([]);useEffect(()=>{try{const parsedImages=value?JSON.parse(`[${value}]`):[];setLocalImages(parsedImages);localImagesRef.current=parsedImages}catch(e){setLocalImages([]);localImagesRef.current=[]}},[value]);const convertArrayToString=arr=>{const str=JSON.stringify(arr);return str.length>2?str.slice(1,-1):""};const handleDragUpdate=dragOverIndex=>{if(dragItem.current===dragOverIndex)return;const reorderedImages=[...localImagesRef.current];const draggedItemContent=reorderedImages.splice(dragItem.current,1)[0];reorderedImages.splice(dragOverIndex,0,draggedItemContent);dragItem.current=dragOverIndex;localImagesRef.current=reorderedImages;setLocalImages(reorderedImages)};const handleDrop=e=>{e.preventDefault();const finalString=convertArrayToString(localImagesRef.current);setAttributes({[name]:finalString});dragItem.current=null};const handleDelete=indexToDelete=>{if(window.confirm(__("Are you sure?"))){const newImages=localImagesRef.current.filter((_,index)=>index!==indexToDelete);setAttributes({[name]:convertArrayToString(newImages)})}};return el("div",{className:"row row-cols-3 px-2 sd-sortable","data-field":name,onDrop:handleDrop,onDragOver:e=>e.preventDefault()},localImages.map((img,index)=>el("div",{key:img.id?`${img.id}-${index}`:index,className:"col p-2",style:{position:"relative",cursor:"move",transition:"transform 0.2s ease-in-out"},draggable:true,onDragStart:e=>dragItem.current=index,onDragEnter:e=>handleDragUpdate(index),onDragEnd:()=>dragItem.current=null},el("div",{className:"ratio ratio-1x1"},el("img",{src:img.sizes?.thumbnail?.url||img.url,style:{maxWidth:"100%",background:"#ccc",pointerEvents:"none"},className:"embed-item-cover-xy"})),el("i",{className:"fas fa-times-circle text-danger position-absolute ml-n2 mt-n1 bg-white rounded-circle c-pointer",title:__("Delete"),style:{top:"6px",right:"3px"},onClick:()=>handleDelete(index)}))))};const onSelectImages=media=>{let existingImages=[];if(value&&typeof value==="string"){try{existingImages=JSON.parse(`[${value}]`)}catch(e){existingImages=[]}}const newImages=media.map(img=>({id:img.id,caption:img.caption,description:img.description,title:img.title,alt:img.alt,sizes:img.sizes,url:img.url}));const allImages=[...existingImages,...newImages];const stringValue=JSON.stringify(allImages);setAttributes({[name]:stringValue.length>2?stringValue.slice(1,-1):""})};const onClearImages=()=>setAttributes({[name]:""});return el(BaseControl,{key:name,label:labelWithIcon,help:controlHelp},el(MediaUploadCheck,{},el(MediaUpload,{onSelect:onSelectImages,allowedTypes:["image"],multiple:true,value:[],render:({open})=>el("div",{},el(Button,{isPrimary:true,onClick:open},__("Upload Images")),el(ImagesPreviewControl,{value:value,name:name,setAttributes:setAttributes}),value&&el(Button,{isSecondary:true,style:{margin:"8px 0"},onClick:onClearImages},__("Clear All")))})))}case"select":let selectOptions=[];if(options&&typeof options==="object"){selectOptions=Object.keys(options).map(key=>({label:options[key],value:key}))}const isMultiple=rest.multiple||false;const controlValue=value!==undefined&&value!==null?value:isMultiple?[]:"";return el(BaseControl,{key:name,label:labelWithIcon,id:name},el(SelectControl,{value:controlValue,options:selectOptions,onChange:val=>setAttributes({[name]:val}),multiple:isMultiple,...rest}),controlHelp&&el("p",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:controlHelp}}));case"checkbox":return el(Fragment,{key:name},el(ToggleControl,{label:labelWithIcon,checked:!!value,onChange:isChecked=>setAttributes({[name]:isChecked}),...rest}),controlHelp&&el("p",{className:"components-base-control__help",style:{marginTop:"-8px"},dangerouslySetInnerHTML:{__html:controlHelp}}));case"color":return el(Fragment,{key:name},el("p",{className:"components-base-control__label"},labelWithIcon),el(ColorPicker,{color:value,onChangeComplete:color=>{const newColor=color.rgb.a<1?`rgba(${color.rgb.r},${color.rgb.g},${color.rgb.b},${color.rgb.a})`:color.hex;setAttributes({[name]:newColor})},disableAlpha:rest.disable_alpha||false}),controlHelp&&el("p",{className:"components-base-control__help"},controlHelp));case"gradient":const safeValue=value||null;return el(BaseControl,{key:name,label:labelWithIcon,id:name},el(GradientPicker,{value:safeValue,onChange:newGradient=>setAttributes({[name]:newGradient}),...rest,gradients:[{name:"Vivid cyan blue to vivid purple",gradient:"linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%)",slug:"vivid-cyan-blue-to-vivid-purple"},{name:"Light green cyan to vivid green cyan",gradient:"linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%)",slug:"light-green-cyan-to-vivid-green-cyan"},{name:"Luminous vivid amber to luminous vivid orange",gradient:"linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%)",slug:"luminous-vivid-amber-to-luminous-vivid-orange"},{name:"Luminous vivid orange to vivid red",gradient:"linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%)",slug:"luminous-vivid-orange-to-vivid-red"},{name:"Very light gray to cyan bluish gray",gradient:"linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%)",slug:"very-light-gray-to-cyan-bluish-gray"},{name:"Cool to warm spectrum",gradient:"linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%)",slug:"cool-to-warm-spectrum"}]}),controlHelp&&el("p",{className:"components-base-control__help",dangerouslySetInnerHTML:{__html:controlHelp}}));case"notice":return el(Notice,{key:name,status:rest.status||"info",isDismissible:false},el("div",{dangerouslySetInnerHTML:{__html:controlHelp}}));case"visibility_conditions":return el(BaseControl,{label:controlLabel,help:controlHelp,id:name,key:name},el(TextControl,{value:value,disabled:true,style:{marginBottom:"8px"}}),el(Button,{isPrimary:true,onClick:()=>openVisibilityModal()},rest.button_title||controlLabel));default:return null}}window.sdBlockFunctions.renderControl=renderControl;function hasSelectedInnerBlock(props){return wp.data.select("core/block-editor").hasSelectedInnerBlock(props.clientId,true)}window.registerSuperDuperBlock=function(config,ajaxNonce){if(!config||!config.name)return;const{name,title,description,icon:iconString,category,keywords,arguments:argsConfig,options:blockOptions}=config;const hydratedArgsConfig=argsConfig.map(arg=>{if(arg.template&&window.sdBlockInputComponents&&window.sdBlockInputComponents[arg.template]){const component=window.sdBlockInputComponents[arg.template];if(component.config){return{...component.config,...arg}}}return arg});const blockAttributes={};let hasAdvancedFields=false;hydratedArgsConfig.forEach(arg=>{if(arg.advanced)hasAdvancedFields=true;let attrType="string";let attrDefault=arg.default!==undefined?arg.default:"";if(arg.type==="checkbox"||arg.type==="toggle"){attrType="boolean";attrDefault=!!attrDefault}else if(arg.type==="number"){attrType="number";attrDefault=attrDefault!==""?Number(attrDefault):undefined}else if(arg.type==="hidden"){if(arg.hidden_type==="number"){attrType="number";attrDefault=arg.default!==undefined?Number(arg.default):undefined}else if(arg.hidden_type==="object"){attrType="object";attrDefault=arg.default||{}}else{attrType="string";attrDefault=arg.default!==undefined?String(arg.default):""}}else if(arg.type==="image_xy"){attrType="object";attrDefault=arg.default||{x:.5,y:.5}}else if(arg.type==="select"&&arg.multiple){attrType="array";attrDefault=attrDefault?String(attrDefault).split(","):[]}blockAttributes[arg.name]={type:attrType,default:attrDefault}});blockAttributes.metadata={type:"object"};blockAttributes.className={type:"string"};if(!blockOptions["nested-block"]){blockAttributes.content={type:"string"}}blockAttributes.sd_shortcode={type:"string"};blockAttributes.sd_shortcode_close={type:"string"};blockAttributes.styleid={type:"string"};if(hasAdvancedFields)blockAttributes.show_advanced={type:"boolean",default:false};let blockIcon=iconString&&iconString.includes("fa-")?el("i",{className:iconString}):iconString||"shield-alt";const blockTransforms={};if(blockOptions["block-transforms"]){const fromConfig=blockOptions["block-transforms"].from;if(fromConfig){const fromRules=Array.isArray(fromConfig)?fromConfig:[fromConfig];blockTransforms.from=fromRules.map(rule=>{if(!rule.blocks||!rule.args)return null;return{type:"block",blocks:rule.blocks,transform:sourceAttributes=>{const newAttributes={};for(const destAttr in rule.args){const sourceAttrKey=rule.args[destAttr];let sourceValue;if(sourceAttrKey==="text"){sourceValue=sourceAttributes.content}else{sourceValue=sourceAttributes[sourceAttrKey]}if(sourceValue!==undefined){newAttributes[destAttr]=sourceValue}}return createBlock(name,newAttributes)}}}).filter(Boolean)}}registerBlockType(name,{apiVersion:blockOptions["block-api-version"],title:title,description:description,icon:blockIcon,category:category,keywords:keywords,attributes:blockAttributes,transforms:blockTransforms,example:blockOptions["block-example"],supports:{html:false,...blockOptions.supports||{}},__experimentalLabel:attributes=>{const visibilityHtml=attributes&&attributes.visibility_conditions?" ðŸ‘":"";if(attributes?.metadata?.name)return attributes.metadata.name+visibilityHtml;if(blockOptions["block-label"]){let Tpl=blockOptions["block-label"];const resolvePlaceholders=str=>str.replace(/%([a-zA-Z0-9_]+)%/g,(match,attrName)=>attributes[attrName]||"");const ternaryRegex=/%([a-zA-Z0-9_]+)%\s*\?\s*(.*?)\s*:\s*(.*)/;const match=Tpl.match(ternaryRegex);if(match){const[,conditionAttr,truePart,falsePart]=match;if(attributes[conditionAttr])return resolvePlaceholders(truePart)+visibilityHtml;else return resolvePlaceholders(falsePart)+visibilityHtml}else{return resolvePlaceholders(Tpl)+visibilityHtml}}return title+visibilityHtml},edit:function(props){const{clientId}=props;const{parentBlocks,childBlocks}=wp.data.useSelect(select=>{const{getBlockParents,getBlocksByClientId,getBlocks}=select("core/block-editor");const parentClientIds=getBlockParents(clientId);return{parentBlocks:getBlocksByClientId(parentClientIds),childBlocks:getBlocks(clientId)}},[clientId]);const{attributes,setAttributes}=props;const blockProps=useBlockProps();const deviceType=wp.data.useSelect(select=>select("core/editor")?.getDeviceType()||"Desktop",[]);const[activeTab,setActiveTab]=useState(blockOptions.block_group_tabs&&Object.keys(blockOptions.block_group_tabs).length?Object.values(blockOptions.block_group_tabs)[0].tab.key:null);const[isVisibilityModalOpen,setVisibilityModalOpen]=useState(false);const[isDynamicDataModalOpen,setDynamicDataModalOpen]=useState(false);const[previewHtml,setPreviewHtml]=useState(attributes.content||"Loading preview...");if(blockOptions.editHook&&typeof window.sdBlockFunctions[blockOptions.editHook]==="function"){const HookToUse=window.sdBlockFunctions[blockOptions.editHook];HookToUse(previewHtml,blockProps.id)}const dynamicDataField=blockOptions["block-dynamic-field"];const blockWrapperRef=useRef(null);let updateCaret=()=>{};let handleSelect=dataTag=>{};let handleTextChange=newHtmlString=>{if(dynamicDataField){setAttributes({[dynamicDataField]:newHtmlString})}};if(dynamicDataField){const[caretOffset,setCaretOffset]=useState(null);useEffect(()=>{if(blockProps.id){let element=document.getElementById(blockProps.id);if(!element){const iframe=document.querySelector('iframe[name="editor-canvas"]');if(iframe&&iframe.contentDocument){element=iframe.contentDocument.getElementById(blockProps.id)}}blockWrapperRef.current=element}},[attributes,blockProps.id]);updateCaret=()=>{const node=blockWrapperRef.current;if(!node)return;const sel=node.ownerDocument.defaultView.getSelection();if(!sel.rangeCount)return;const range=sel.getRangeAt(0);const editableEl=node.querySelector('[contenteditable="true"]');if(!editableEl||!editableEl.contains(range.startContainer))return;const pre=range.cloneRange();pre.selectNodeContents(editableEl);pre.setEnd(range.endContainer,range.endOffset);setCaretOffset(pre.toString().length)};handleSelect=dataTag=>{const existingText=attributes[dynamicDataField]||"";const offset=caretOffset!==null?caretOffset:existingText.length;const before=existingText.slice(0,offset);const after=existingText.slice(offset);setAttributes({[dynamicDataField]:before+dataTag+after});setDynamicDataModalOpen(false);setCaretOffset(null)}}const{content,sd_shortcode,sd_shortcode_close,styleid,...watchedAttributes}=attributes;const isInitialMount=useRef(true);useEffect(()=>{if(!attributes.sd_shortcode||!attributes.styleid){const newAttrs={};if(!attributes.sd_shortcode){newAttrs.sd_shortcode=config.base_id;if(blockOptions["nested-block"])newAttrs.sd_shortcode_close=config.base_id}if(!attributes.styleid)newAttrs.styleid="block-"+(Math.random()+1).toString(36).substring(2);if(Object.keys(newAttrs).length>0)setAttributes(newAttrs)}const wantsAjaxPreview=blockOptions["ajaxPreviewInEditComponent"]===true;const hasEditComponent=!!blockOptions["editComponent"];if(blockOptions["nested-block"]||hasEditComponent&&!wantsAjaxPreview){return}const fetchPreview=()=>{const formData=new FormData;formData.append("action","super_duper_output_shortcode");formData.append("shortcode",config.base_id);formData.append("_ajax_nonce",ajaxNonce);const buildFormData=(data,parentKey)=>{if(data&&typeof data==="object"&&!(data instanceof Date)&&!(data instanceof File)&&!Array.isArray(data)){Object.keys(data).forEach(key=>{buildFormData(data[key],parentKey?`${parentKey}[${key}]`:key)})}else if(Array.isArray(data)){data.forEach((value,index)=>{buildFormData(value,`${parentKey}[${index}]`)})}else{const value=data==null?"":data;formData.append(parentKey,value)}};const attributesForAjax={...attributes};delete attributesForAjax.content;buildFormData(attributesForAjax,"attributes");fetch(ajaxurl,{method:"POST",body:formData}).then(response=>{if(!response.ok){throw new Error("Network response was not ok.")}return response.text()}).then(newContent=>{const contentToSet=newContent||`<div class="sd-placeholder">Empty ${title} block.</div>`;setPreviewHtml(contentToSet);if(contentToSet!==attributes.content){setAttributes({content:contentToSet})}}).catch(error=>{console.error("Super Duper preview fetch error:",error);setPreviewHtml('<div class="sd-placeholder-error">Error loading preview.</div>')})};const handler=setTimeout(()=>{if(isInitialMount.current){if(!attributes.content)fetchPreview();isInitialMount.current=false}else{fetchPreview()}},300);return()=>clearTimeout(handler)},[JSON.stringify(watchedAttributes)]);const groupedArgs=useMemo(()=>{const groups={};hydratedArgsConfig.forEach(arg=>{const group=arg.group||"General";if(!groups[group])groups[group]=[];groups[group].push(arg)});return groups},[hydratedArgsConfig]);const renderGroupControls=groupName=>{const groupArgs=groupedArgs[groupName]||[];const elements=[];const renderedRows={};const propsWithModal={...props,openVisibilityModal:()=>setVisibilityModalOpen(true)};groupArgs.forEach(arg=>{if(arg.row&&arg.row.key){if(renderedRows[arg.row.key])return;const rowKey=arg.row.key;const rowTitle=arg.row.title;const rowElements=groupArgs.filter(rowArg=>rowArg.row&&rowArg.row.key===rowKey&&rowArg.device_type===deviceType).map(rowArg=>renderInlineControl(rowArg,props));if(rowElements.length>0){elements.push(el(BaseControl,{key:rowKey,label:el("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},el("span",{},rowTitle),el(DeviceSwitcherIcon,{isInlineRow:true}))},el("div",{className:"sd-control-row",style:{display:"flex",gap:"8px",alignItems:"flex-end"}},rowElements)))}renderedRows[rowKey]=true}else if(arg.template){const component=window.sdBlockInputComponents&&window.sdBlockInputComponents[arg.template];if(component&&typeof component.renderer==="function"){elements.push(component.renderer(propsWithModal,arg,deviceType))}}else if(!arg.row){elements.push(renderControl(arg,propsWithModal,deviceType))}});return elements};const inspectorPanels=useMemo(()=>{if(blockOptions.block_group_tabs&&Object.keys(blockOptions.block_group_tabs).length){const tabs=Object.values(blockOptions.block_group_tabs).map(tabInfo=>({name:tabInfo.tab.key,title:tabInfo.tab.title,className:tabInfo.tab.class+" text-center flex-fill d-flex justify-content-center ",groups:tabInfo.groups}));return el("div",{className:"bsui"},el("hr",{className:"m-0"}),el(TabPanel,{className:"sd-inspector-tabs",activeClass:"is-active",tabs:tabs,initialTabName:activeTab,onSelect:setActiveTab,children:tab=>el(Fragment,{},tab.groups.map(groupName=>{if(!groupedArgs[groupName])return null;return el(PanelBody,{title:groupName,initialOpen:true,key:`${tab.name}-${groupName}`},renderGroupControls(groupName))}))}))}else{return Object.keys(groupedArgs).map((groupName,index)=>el(PanelBody,{title:groupName,initialOpen:index===0,key:groupName},renderGroupControls(groupName)))}},[deviceType,activeTab,JSON.stringify(attributes),groupedArgs]);const advancedToggle=hasAdvancedFields?el("div",{style:{padding:"0 16px 16px"}},el(ToggleControl,{label:"Show Advanced Settings",checked:!!attributes.show_advanced,onChange:()=>setAttributes({show_advanced:!attributes.show_advanced})})):null;const tools={props:props,...props,el:el,blockProps:blockProps,blockWrapperRef:blockWrapperRef,parentBlocks:parentBlocks,childBlocks:childBlocks,__:__,Fragment:Fragment,BlockControls:BlockControls,ToolbarGroup:ToolbarGroup,ToolbarButton:ToolbarButton,RichText:RichText,InnerBlocks:InnerBlocks,isModalOpen:isDynamicDataModalOpen,setModalOpen:setDynamicDataModalOpen,handleTextChange:handleTextChange,handleSelect:handleSelect,updateCaret:updateCaret,previewHtml:previewHtml,...window.sdBlockFunctions};let mainContent;const editComponentKey=blockOptions["editComponent"];if(editComponentKey&&typeof window.sdBlockEditComponents[editComponentKey]==="function"){const EditComponent=window.sdBlockEditComponents[editComponentKey];mainContent=el(EditComponent,tools)}else{const wrapperElement=blockOptions["block-wrap"]||"div";mainContent=el(wrapperElement,{...blockProps,dangerouslySetInnerHTML:{__html:previewHtml}})}return el(Fragment,{},el(InspectorControls,{key:"inspector"},advancedToggle,inspectorPanels),mainContent,isVisibilityModalOpen&&window.sdBlockTools?.VisibilityConditionsModal?el(window.sdBlockTools.VisibilityConditionsModal,{isOpen:isVisibilityModalOpen,onClose:()=>setVisibilityModalOpen(false),value:attributes.visibility_conditions,onSave:newValue=>{setAttributes({visibility_conditions:newValue});setVisibilityModalOpen(false)}}):null,isDynamicDataModalOpen&&window.sdBlockTools?.DynamicDataModal?el(window.sdBlockTools.DynamicDataModal,{isOpen:isDynamicDataModalOpen,onSelect:handleSelect,onClose:()=>setDynamicDataModalOpen(false)}):null)},save:function(props){const saveComponentKey=blockOptions["saveComponent"];const{InnerBlocks}=wp.blockEditor;const blockProps=useBlockProps.save();const tools={props:props,...props,el:el,blockProps:blockProps,__:__,RichText:RichText,Fragment:Fragment,InnerBlocks:InnerBlocks,...window.sdBlockFunctions,sd_build_aui_class:typeof sd_build_aui_class!=="undefined"?sd_build_aui_class:()=>"",sd_build_aui_styles:typeof sd_build_aui_styles!=="undefined"?sd_build_aui_styles:()=>({})};if(saveComponentKey&&typeof window.sdBlockSaveComponents[saveComponentKey]==="function"){const SaveComponent=window.sdBlockSaveComponents[saveComponentKey];return el(SaveComponent,tools)}if(blockOptions["nested-block"]){return el(InnerBlocks.Content)}return null}})}})(window.wp);